import Link from 'next/link'
import Layout from '../components/Layout.js'
import Featured from '../components/Featured.js'
import CategoryList from '../components/CategoryList.js'
import CardList from "../components/CardList.js";
import Menu from "../components/Menu.js";
import { server } from '../config/config.js';

export const getServerSideProps = async (ctx) => {
  const page = parseInt(ctx.query.page) || 1
  const cat = ctx.query.cat || ""
  const response_cat = await fetch(`${server}/api/categories`)
  const response_articles = await fetch(`${server}/api/articles?page=${page}&cat=${cat}`)
  const articles = await response_articles.json()
  const categories = await response_cat.json()

  return {
    props: {
      articles: articles,
      categories: categories,
      page: page,
      cat: cat
    }
  }
}

export default function Page(props) {
  return (
    <Layout
      title=""
      description="Generated by create next app"
    >
      <div className="">
        <Featured />
        <CategoryList {...props} />
        <div className="flex gap-[50px]">
          <CardList {...props} />
          <Menu />
        </div>
      </div>
    </Layout>
  )
}
